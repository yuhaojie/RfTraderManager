/*!
 * Audio5js: HTML5 Audio Compatibility Layer
 * https://github.com/zohararad/audio5js
 * License MIT (c) Zohar Arad 2013
 */
(function(f,d,e){if(typeof(module)!=="undefined"&&module.exports){module.exports=e(d,f)}else{if(typeof(define)==="function"&&define.amd){define(function(){return e(d,f)})}else{f[d]=e(d,f)}}}(window,"Audio5js",function(v,B){var z=B.ActiveXObject;function s(a){this.message=a}s.prototype=new Error();function p(b){var a={},c;for(c in b){if(typeof(b[c])==="object"){a[c]=p(b[c])}else{a[c]=b[c]}}return a}var x=function(a,c){var b,d=p(c);for(b in d){if(d.hasOwnProperty(b)){a[b]=d[b]}}return a};var C=function(a,b){return x(a.prototype,b)};var q={on:function(b,a,c){this.subscribe(b,a,c,false)},one:function(b,a,c){this.subscribe(b,a,c,true)},off:function(d,a){if(this.channels[d]===undefined){return}var c,e;for(c=0,e=this.channels[d].length;c<e;c++){var b=this.channels[d][c].fn;if(b===a){this.channels[d].splice(c,1);break}}},subscribe:function(c,a,d,b){if(this.channels===undefined){this.channels={}}this.channels[c]=this.channels[c]||[];this.channels[c].push({fn:a,ctx:d,once:(b||false)})},trigger:function(c){if(this.channels&&this.channels.hasOwnProperty(c)){var b=Array.prototype.slice.call(arguments,1);var d=[];while(this.channels[c].length>0){var a=this.channels[c].shift();if(typeof(a.fn)==="function"){a.fn.apply(a.ctx,b)}if(!a.once){d.push(a)}}this.channels[c]=d}}};var y={flash_embed_code:function(a,b,d){var c;var e='<param name="movie" value="'+b+"?playerInstance=window."+v+"_flash.instances['"+a+"']&datetime="+d+'"/><param name="wmode" value="transparent"/><param name="allowscriptaccess" value="always" /></object>';if(z){c='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="'+a+'">'}else{c='<object type="application/x-shockwave-flash" data="'+b+"?playerInstance=window."+v+"_flash.instances['"+a+"']&datetime="+d+'" width="1" height="1" id="'+a+'" >'}return c+e},can_play:function(a){var d=document.createElement("audio");var c;switch(a){case"mp3":c="audio/mpeg;";break;case"vorbis":c='audio/ogg; codecs="vorbis"';break;case"opus":c='audio/ogg; codecs="opus"';break;case"webm":c='audio/webm; codecs="vorbis"';break;case"mp4":c='audio/mp4; codecs="mp4a.40.5"';break;case"wav":c='audio/wav; codecs="1"';break}if(c!==undefined){if(a==="mp3"&&navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Firefox/i)){return true}try{return !!d.canPlayType&&d.canPlayType(c)!==""}catch(b){return false}}return false},has_flash:(function(){var d=false;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"]){d=true}else{if(navigator.mimeTypes&&navigator.mimeTypes.length){var a=navigator.mimeTypes["application/x-shockwave-flash"];d=a&&a.enabledPlugin}else{try{var c=new z("ShockwaveFlash.ShockwaveFlash");d=typeof(c)==="object"}catch(b){}}}return d}()),embedFlash:function(b,a){var c=document.createElement("div");c.style.position="absolute";c.style.width="1px";c.style.height="1px";c.style.top="1px";document.body.appendChild(c);if(typeof(B.swfobject)==="object"){var e={playerInstance:"window."+v+"_flash.instances['"+a+"']"};var d={allowscriptaccess:"always",wmode:"transparent"};c.innerHTML='<div id="'+a+'"></div>';swfobject.embedSWF(b+"?ts="+(new Date().getTime()+Math.random()),a,"1","1","9.0.0",null,e,d)}else{var f=new Date().getTime()+Math.random();c.innerHTML=this.flash_embed_code(a,b,f)}return document.getElementById(a)},formatTime:function(a){var e=parseInt(a/3600,10)%24;var b=parseInt(a/60,10)%60;var c=parseInt(a%60,10);var f,d=(b<10?"0"+b:b)+":"+(c<10?"0"+c:c);if(e>0){f=(e<10?"0"+e:e)+":"+d}else{f=d}return f}};y.use_flash=y.can_play("mp3");var D,r,w;var t={playing:false,vol:1,duration:0,position:0,load_percent:0,seekable:false,ready:null};var u=B[v+"_flash"]=B[v+"_flash"]||{instances:{},count:0};r=function(){if(y.use_flash&&!y.has_flash){throw new Error("Flash Plugin Missing")}};r.prototype={init:function(a){u.count+=1;this.id=v+u.count;u.instances[this.id]=this;this.embed(a)},embed:function(a){y.embedFlash(a,this.id)},eiReady:function(){this.audio=document.getElementById(this.id);this.trigger("ready")},eiLoadStart:function(){this.trigger("loadstart")},eiLoadedMetadata:function(){this.trigger("loadedmetadata")},eiCanPlay:function(){this.trigger("canplay")},eiTimeUpdate:function(c,a,b){this.position=c;this.duration=a;this.seekable=b;this.trigger("timeupdate",c,(this.seekable?a:null))},eiProgress:function(c,a,b){this.load_percent=c;this.duration=a;this.seekable=b;this.trigger("progress",c)},eiLoadError:function(a){this.trigger("error",a)},eiPlay:function(){this.playing=true;this.trigger("play")},eiPause:function(){this.playing=false;this.trigger("pause")},eiEnded:function(){this.pause();this.trigger("ended")},eiSeeking:function(){this.trigger("seeking")},eiSeeked:function(){this.trigger("seeked")},reset:function(){this.seekable=false;this.duration=0;this.position=0;this.load_percent=0},load:function(a){this.reset();this.audio.load(a)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(a){if(a!==undefined&&!isNaN(parseInt(a,10))){this.audio.setVolume(a);this.vol=a}else{return this.vol}},seek:function(b){try{this.audio.seekTo(b);this.position=b}catch(a){}},destroyAudio:function(){if(this.audio){this.pause();this.audio.parentNode.removeChild(this.audio);delete u.instances[this.id];delete this.audio}}};C(r,q);C(r,t);w=function(){};w.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio();this.audio.autoplay=false;this.audio.preload="auto";this.audio.autobuffer=true;this.bindEvents()},destroyAudio:function(){if(this.audio){this.pause();this.unbindEvents();try{this.audio.setAttribute("src","")}finally{delete this.audio}}},setupEventListeners:function(){this.listeners={loadstart:this.onLoadStart.bind(this),canplay:this.onLoad.bind(this),loadedmetadata:this.onLoadedMetadata.bind(this),play:this.onPlay.bind(this),pause:this.onPause.bind(this),ended:this.onEnded.bind(this),error:this.onError.bind(this),timeupdate:this.onTimeUpdate.bind(this),seeking:this.onSeeking.bind(this),seeked:this.onSeeked.bind(this)}},bindEvents:function(){if(this.listeners===undefined){this.setupEventListeners()}this.audio.addEventListener("loadstart",this.listeners.loadstart,false);this.audio.addEventListener("canplay",this.listeners.canplay,false);this.audio.addEventListener("loadedmetadata",this.listeners.loadedmetadata,false);this.audio.addEventListener("play",this.listeners.play,false);this.audio.addEventListener("pause",this.listeners.pause,false);this.audio.addEventListener("ended",this.listeners.ended,false);this.audio.addEventListener("error",this.listeners.error,false);this.audio.addEventListener("timeupdate",this.listeners.timeupdate,false);this.audio.addEventListener("seeking",this.listeners.seeking,false);this.audio.addEventListener("seeked",this.listeners.seeked,false)},unbindEvents:function(){this.audio.removeEventListener("loadstart",this.listeners.loadstart);this.audio.removeEventListener("canplay",this.listeners.canplay);this.audio.removeEventListener("loadedmetadata",this.listeners.loadedmetadata);this.audio.removeEventListener("play",this.listeners.play);this.audio.removeEventListener("pause",this.listeners.pause);this.audio.removeEventListener("ended",this.listeners.ended);this.audio.removeEventListener("error",this.listeners.error);this.audio.removeEventListener("timeupdate",this.listeners.timeupdate);this.audio.removeEventListener("seeking",this.listeners.seeking);this.audio.removeEventListener("seeked",this.listeners.seeked)},onLoadStart:function(){this.trigger("loadstart")},onLoad:function(){if(!this.audio){return setTimeout(this.onLoad.bind(this),100)}this.seekable=this.audio.seekable&&this.audio.seekable.length>0;if(this.seekable){this.timer=setInterval(this.onProgress.bind(this),250)}this.trigger("canplay")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=true;this.trigger("play")},onPause:function(){this.playing=false;this.trigger("pause")},onEnded:function(){this.playing=false;this.trigger("ended")},onTimeUpdate:function(){if(this.audio&&this.playing){try{this.position=this.audio.currentTime;this.duration=this.audio.duration===Infinity?null:this.audio.duration}catch(a){}this.trigger("timeupdate",this.position,this.duration)}},onProgress:function(){if(this.audio&&this.audio.buffered!==null&&this.audio.buffered.length){this.duration=this.audio.duration===Infinity?null:this.audio.duration;this.load_percent=parseInt(((this.audio.buffered.end(this.audio.buffered.length-1)/this.duration)*100),10);this.trigger("progress",this.load_percent);if(this.load_percent>=100){this.clearLoadProgress()}}},onError:function(a){this.trigger("error",a)},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},clearLoadProgress:function(){if(this.timer!==undefined){clearInterval(this.timer);delete this.timer}},reset:function(){this.clearLoadProgress();this.seekable=false;this.duration=0;this.position=0;this.load_percent=0},load:function(a){this.reset();this.trigger("pause");if(this.audio===undefined){this.createAudio()}this.audio.setAttribute("src",a);this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(b){if(b!==undefined&&!isNaN(parseInt(b,10))){var a=b<0?0:Math.min(1,b);this.audio.volume=a;this.vol=a}else{return this.vol}},seek:function(b){var a=this.playing;this.position=b;this.audio.currentTime=b;if(a){this.play()}else{if(this.audio.buffered!==null&&this.audio.buffered.length){this.trigger("timeupdate",this.position,this.duration)}}}};C(w,q);C(w,t);var A={swf_path:"/swf/audiojs.swf",throw_errors:true,format_time:true,codecs:["mp3"]};D=function(a){a=a||{};var b;for(b in A){if(A.hasOwnProperty(b)&&!a.hasOwnProperty(b)){a[b]=A[b]}}this.init(a)};D.can_play=function(a){return y.can_play(a)};D.prototype={init:function(a){this.ready=false;this.settings=a;this.audio=this.getPlayer();this.bindAudioEvents();if(this.settings.use_flash){this.audio.init(a.swf_path)}else{this.audio.init()}},getPlayer:function(){var b,d,c,a;if(this.settings.use_flash){c=new r();this.settings.player={engine:"flash",codec:"mp3"}}else{for(b=0,d=this.settings.codecs.length;b<d;b++){a=this.settings.codecs[b];if(D.can_play(a)){c=new w();this.settings.use_flash=false;this.settings.player={engine:"html",codec:a};break}}if(c===undefined){this.settings.use_flash=!D.can_play("mp3");c=this.settings.use_flash?new r():new w();this.settings.player={engine:(this.settings.use_flash?"flash":"html"),codec:"mp3"}}}return c},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this);this.audio.on("loadstart",this.onLoadStart,this);this.audio.on("loadedmetadata",this.onLoadedMetadata,this);this.audio.on("play",this.onPlay,this);this.audio.on("pause",this.onPause,this);this.audio.on("ended",this.onEnded,this);this.audio.on("canplay",this.onCanPlay,this);this.audio.on("timeupdate",this.onTimeUpdate,this);this.audio.on("progress",this.onProgress,this);this.audio.on("error",this.onError,this);this.audio.on("seeking",this.onSeeking,this);this.audio.on("seeked",this.onSeeked,this)},unbindAudioEvents:function(){this.audio.off("ready",this.onReady);this.audio.off("loadstart",this.onLoadStart);this.audio.off("loadedmetadata",this.onLoadedMetadata);this.audio.off("play",this.onPlay);this.audio.off("pause",this.onPause);this.audio.off("ended",this.onEnded);this.audio.off("canplay",this.onCanPlay);this.audio.off("timeupdate",this.onTimeUpdate);this.audio.off("progress",this.onProgress);this.audio.off("error",this.onError);this.audio.off("seeking",this.onSeeking);this.audio.off("seeked",this.onSeeked)},load:function(c){var b=this,a=function(d){b.audio.load(d);b.trigger("load")};if(this.ready){a(c)}else{this.on("ready",a)}},play:function(){if(!this.playing){this.audio.play()}},pause:function(){if(this.playing){this.audio.pause()}},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(a){if(a!==undefined&&!isNaN(parseInt(a,10))){this.audio.volume(a);this.vol=a}else{return this.vol}},seek:function(a){this.audio.seek(a);this.position=a},destroy:function(){this.unbindAudioEvents();this.audio.destroyAudio()},onReady:function(){this.ready=true;if(typeof(this.settings.ready)==="function"){this.settings.ready.call(this,this.settings.player)}this.trigger("ready")},onLoadStart:function(){this.trigger("loadstart")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=true;this.trigger("play")},onPause:function(){this.playing=false;this.trigger("pause")},onEnded:function(){this.playing=false;this.trigger("ended")},onError:function(){var a=new s("Audio Error. Failed to Load Audio");if(this.settings.throw_errors){throw a}else{this.trigger("error",a)}},onCanPlay:function(){this.trigger("canplay")},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},onTimeUpdate:function(b,a){this.position=this.settings.format_time?y.formatTime(b):b;if(this.duration!==a){this.duration=this.settings.format_time&&a!==null?y.formatTime(a):a}this.trigger("timeupdate",this.position,this.duration)},onProgress:function(a){this.duration=this.audio.duration;this.load_percent=a;this.trigger("progress",a)}};C(D,q);C(D,t);return D}));var audio=function(){var b=function(a){var d=null;this.options=$.extend({audio:[],autoPlay:false,loop:false,playAll:true,cur:0,end:null},a);this.init()};b.prototype={init:function(d){var a=this;player=new Audio5js({swf_path:"http://test.nie.163.com/test11/baolong/nie-audio/audio5js.swf",throw_errors:true,format_time:true,ready:function(g){var h=a.options,c=this;this.load(h.audio[h.cur]);if(h.autoPlay){this.play()}this.on("ended",function(){h.end&&h.end(h.cur,h.audio.length);if(h.playAll){if((h.cur<h.audio.length-1)){a.next()}else{if(h.loop){h.cur=0;c.load(h.audio[h.cur]);c.play()}}}else{c.pause()}});this.on("error",function(e){console.log(e.msg)})}})},play:function(){player.play()},pause:function(){player.pause()},playPause:function(){player.playPause()},next:function(){var a=this.options;if(a.cur<a.audio.length-1){a.cur++}else{a.cur=0}player.pause();player.load(a.audio[a.cur]);player.play()},prev:function(){var a=this.options;if(a.cur>0){a.cur--}else{a.cur=a.audio.length-1}player.pause();player.load(a.audio[a.cur]);player.play()},toPlay:function(d){var a=this.options;if(d<=a.audio.length){a.cur=d-1}else{a.cur=0}player.pause();player.load(a.audio[a.cur]);player.play()}};return{create:function(a){return new b(a)}}}();